<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        .drag-over {
            background-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <div class="p-4">
        <h1 class="text-3xl font-bold mb-6 text-white">üóÇÔ∏è Task Board</h1>
        <div id="columns" class="flex gap-4 overflow-x-auto pb-4">
            {% for column in columns %}
            <div class="bg-gray-800 shadow p-4 rounded w-64" data-column-id="{{ column.id }}" ondrop="drop(event)" ondragover="allowDrop(event)">
                <h2 class="font-semibold text-lg mb-2 text-white">{{ column.title }}</h2>

                <div class="space-y-2 min-h-[100px]">
                    {% for task in column.tasks.all %}
                    <div class="bg-gray-700 hover:bg-gray-600 p-2 rounded cursor-move transition" draggable="true" ondragstart="drag(event)" id="task-{{ task.id }}">
                        {{ task.title }}
                    </div>
                    {% endfor %}
                </div>

                <form method="post" action="{% url 'add_task' column.id %}" class="mt-3">
                    {% csrf_token %}
                    <input name="title" placeholder="New task" class="p-1 w-full bg-gray-700 text-white border border-gray-600 rounded placeholder-gray-400" required>
                    <button class="mt-2 bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded w-full transition">Add</button>
                </form>
            </div>
            {% endfor %}

            <!-- –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –∫–æ–ª–æ–Ω–∫—É -->
            <form method="post" action="{% url 'add_column' %}" class="bg-gray-800 shadow p-4 rounded w-64">
                {% csrf_token %}
                <input name="title" placeholder="New column" class="p-1 w-full bg-gray-700 text-white border border-gray-600 rounded placeholder-gray-400" required>
                <button class="mt-2 bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded w-full transition">Add Column</button>
            </form>
        </div>
    </div>

    <script>
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData("text");
            const task = document.getElementById(taskId);
            ev.currentTarget.querySelector('.space-y-2').appendChild(task);
            ev.currentTarget.classList.remove('drag-over');

            // TODO: AJAX –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
        }
    </script>

</body>
</html>
